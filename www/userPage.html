<!DOCTYPE html>
<html>
<head>
    <title>After</title>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="scripts/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    
    <meta http-equiv="Content-Security-Policy" content="default-src *; style-src *  'unsafe-inline'; script-src *  'unsafe-inline'; media-src *">

</head>
<body>
    
    <script type="text/javascript">
        $(document).ready(function () {
            var email_stred = window.localStorage.getItem("emai");
            var userName = email_stred.substr(0, email_stred.indexOf('@'));
            window.localStorage.setItem("UserName", userName);
            $("#user").text(userName);
            if (window.localStorage.getItem("logged_in") != "1") {

                $("#insert").ready(function () {

                    //Regexp to check if email is valid

                    var dataString = window.localStorage.getItem("datstr");     //from previous page
                    window.localStorage.setItem("logged_in", "1");
                    var email_stred = window.localStorage.getItem("emai");
                    var userName = email_stred.substr(0, email_stred.indexOf('@'));
                    window.localStorage.setItem("UserName", userName);
                    $("#user").text(userName);
                    if(window.localStorage.getItem("Alreadr_member")!="1"){
                    $.ajax({
                        type: "POST",                                           //method
                        url: "http://forwardingenuity.com/insert_user.php",     //url   
                        data: dataString,                                       //data sent as concatinated string
                        crossDomain: true,
                        cache: false,
                        beforeSend: function () { $("#insert").val('Connecting...'); },
                        success: function (data) {
                            if (data == "success") {
                                $("#Par_empty").text("");
                                $("#insert").val('submit');

                            }
                            else if (data == "error") {
                                alert("error");
                            }
                        }
                    });
                    
                    return false;
                    }



                });

            }
            

               var url1 = "http://forwardingenuity.com/json_users.php"; //Get url of php file containing json

                var ourRequest = new XMLHttpRequest(); //create XMLHttpRequest object to request for the JSON data
                ourRequest.open("GET", url1);   //Opening...    
                 //container div
                ourRequest.onload = function () {
                   


                    //request has loaded
                    //window.localStorage.setItem("Holding", ourRequest.responseText);
                    var ourData = JSON.parse(ourRequest.responseText);      //change the received response text to an actuall array of objects
                    var books = 0;        //any books under the faculty?
                    console.log(ourData);

                    //var ourData2 = JSON.parse(window.localStorage.getItem("Holding"));
                    var info_length = (ourData.length);
                    
                    for (var i = 0; i < info_length; i++) {
                        if (ourData[i].email == email && ourData[i].password == password)    //find books under faculty
                        {
                            window.localStorage.setItem("emai", ourData[i].email);
                            window.localStorage.setItem("Alreadr_member", "1");
                            window.localStorage.setItem("id", ourData[i].id);
                            window.location.replace("userPage.html");

                        }
                        //books++;
                        else
                        {
                                
                        }

                    }
                    if (books == 0) {
                        //alert("No books available");
                        //No books in the div
                        $("#Par_empty").text("Email/Password combination is not valid");

                    }

                    /*var par = document.createElement('p');
                    par.id = "paragraph" + i;*-
                    par.innerHTML = '<strong>' + ourData2[1].title + '</strong>' + '<br />' + 'R400' + '&nbsp &nbsp &nbsp' + '0739995999';
                    outDiv.appendChild(par);
                  */

                }
                ourRequest.send();
                            //Go to succeeded page
            





        });
      
      function logout() {
          var Logout_button = document.getElementById("logout");
          window.localStorage.setItem("logged_in", "0");
          window.location.replace("index.html");

      }
      
      $("#sub").click(function () {

          //Regexp to check if email is valid

          var dataString = window.localStorage.getItem("datstr");     //from previous page
          window.localStorage.setItem("logged_in", "1");
          
          $.ajax({
              type: "POST",                                           //method
              url: "http://forwardingenuity.com/insert_book.php",     //url   
              data: dataString,                                       //data sent as concatinated string
              crossDomain: true,
              cache: false,
              beforeSend: function () { $("#insert").val('Connecting...'); },
              success: function (data) {
                  if (data == "success") {
                      $("#Par_empty").text("");
                      $("#insert").val('submit');

                  }
                  else if (data == "error") {
                      alert("error");
                  }
              }
          });

          return false;




      });

        /*
      $("#add_more").click(function () {
          var max_fields = 10; //maximum input boxes allowed
          var wrapper = $(".input_fields_wrap"); //Fields wrapper
          var add_button = $(".add_field_button"); //Add button ID

          var x = 1; //initlal text box count
          $(add_button).click(function (e) { //on add input button click
              e.preventDefault();
              if (x < max_fields) { //max input box allowed
                  x++; //text box increment
                  $(wrapper).append('<div><input type="text" name="mytext[]"/><a href="#" class="remove_field">Remove</a></div>'); //add input box
              }
          });

          $(wrapper).on("click", ".remove_field", function (e) { //user click on remove text
              e.preventDefault(); $(this).parent('div').remove(); x--;
          })
      });

      */
    </script>

    
    <div class="bd-example">
        <div id="wrapper" style="text-align: center">
            <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse">
                <!--<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>-->
                <a class="navbar-brand" href="index.html">Home</a>


                <button class="navbar navbar-brand2 navbar-center btn btn-black1 btn-lg" type="button" id="add" style="display:inline-block" data-toggle="modal" data-target="#myModal">
                    <span class="glyphicon glyphicon-plus white" ></span>
                </button>


             <!--   <button class="btn btn-black pull-right" type="button" id="logout" aria-expanded="false" onclick="logout()">
                    Logout
                </button>
                 -->
                
                    <button class="btn1 btn-black pull-right" type="button" id="logout" aria-expanded="false" onclick="logout()">
                        <center>Logout</center>
                    </button>
                <span class="pull-right white col-sm-1">Logged in as:&nbsp<span id="user"></span></span>
                
            </nav>
        </div>
        </div>



    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Modal Header</h4>
                    <p class="text-danger" id="message"></p>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group input_fields_wrap">
                            <label>Title
                            <span class="pull-right"><button class="btn3 btn-white add_field_button" type="button" id="#add_more" style="display:inline-block">
                                        <span class="glyphicon glyphicon-plus gray"></span>
                                        </button>
                                <button class="btn3 btn-white remove_field_button" type="button" id="#remove" style="display:inline-block">
                                    <span class="glyphicon glyphicon-minus gray"></span>
                                </button>
                                
                                </span>
                            </label>
                            <input type="text" name="mytext[]" class="form-control" placeholder="Enter title" id="title" />

                        </div>
                        <div class="form-group input_fields_wrap1">
                            <label>Price</label>
                            <input class="form-control" name="mytext[]" placeholder="Enter Price" id="price" />
                        </div>

                        <div class="form-group input_fields_wrap3">
                            <label>Contact</label>
                            <input class="form-control" name="mytext[]" placeholder="Enter Phone number" id="contact" />
                        </div>


                        <div class="form-group input_fields_wrap2">
                            <label>Faculty</label>
                            <select class="form-control" id="faculty_chosen" name="mytext[]">
                                <option value="Economic and Management Sciences">Economic and Management Sciences</option>
                                <option value="Education">Education</option>
                                <option value="Engineering, Built Environment & IT">Engineering, Built Environment & IT</option>
                                <option value="Health Sciences">Health Sciences</option>
                                <option value="Humanities">Humanities</option>
                                <option value="Natural & Agricultural Sciences">Natural & Agricultural Sciences</option>
                                <option value="Theology">Theology</option>
                                <option value="Vertinary Science">Vertinary Science</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" data-dismiss="modal"  class="btn btn-default" id="sub">Submit</button>
                </div>
            </div>

        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            var max_fields = 5; //maximum input boxes allowed
            var wrapper = $(".input_fields_wrap"); //Fields wrapper
            var wrapper1 = $(".input_fields_wrap1");
            var wrapper2 = $(".input_fields_wrap2");
            var add_button = $(".add_field_button"); //Add button ID
            var rmv_button = $(".remove_field_button");
            var x = 1; //initlal text box count
            
            $(add_button).click(function (e) { //on add input button click
                e.preventDefault();
                if (x < max_fields) { //max input box allowed
                    
                    x++; //text box increment
                    $(wrapper).append('<div id="titl' + x + '"><input type="text" name="mytext1[]" class="form-control" placeholder="Enter title" id="title'+x+'" /></div>'); //add input box
                    $(wrapper1).append('<div id="pri' + x + '"><input class="form-control" name="mytext2[]" placeholder="Enter Price" id="price' + x + '" /></div>');
                    $(wrapper2).append('<div id="facul' + x + '"><select class="form-control" id="faculty_chosen' + x + '" name="mytext3[]"><option value="Economic and Management Sciences">Economic and Management Sciences</option><option value="Education">Education</option><option value="Engineering, Built Environment & IT">Engineering, Built Environment & IT</option><option value="Health Sciences">Health Sciences</option><option value="Humanities">Humanities</option><option value="Natural & Agricultural Sciences">Natural & Agricultural Sciences</option><option value="Theology">Theology</option><option value="Vertinary Science">Vertinary Science</option></select></div>');
                    window.localStorage.setItem("elems", x);
                }
            });

            $(rmv_button).click(function(e){ //user click on remove text
                //e.preventDefault(); $(this).parent('div').remove();
                var wrapper = $(".input_fields_wrap");
                var wrapper1 = $(".input_fields_wrap1");
                var wrapper2 = $(".input_fields_wrap2");
                if (x == 2) {
                    $('#titl2').remove();
                    $('#pri2').remove();
                    $('#facul2').remove();

                }
                if (x == 3) {
                    $('#titl3').remove();
                    $('#pri3').remove();
                    $('#facul3').remove();

                }
                if (x == 4) {
                    $('#titl4').remove();
                    $('#pri4').remove();
                    $('#facul4').remove();

                }
                if (x == 5) {
                    $('#titl5').remove();
                    $('#pri5').remove();
                    $('#facul5').remove();

                }
                if(x!=1){
                    x--;
                    window.localStorage.setItem("elems", x);
                }
            });
           
        });
      /*  function submitBooks() {

            var el = document.getElementById("faculty_chosen");
            var title = $("#title").val();
            var price = $("#price").val();
            var faculty = el.options[el.selectedIndex].value
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;   //Regexp to check if email is valid
          
            var dataString = "title=" + title + "&price=" + price + "&faculty=" + faculty + "&insert=";
            
            if ($.trim(title).length > 0 & $.trim(price).length > 0) {
                $.ajax({
                    type: "POST",
                    url: "http://forwardingenuity.com/insert_book.php",
                    data: dataString,
                    crossDomain: true,
                    cache: false,
                    beforeSend: function () { $("#insert").val('Connecting...'); },
                    success: function (data) {
                        if (data == "success") {
                            alert("inserted");                      
                            $("#message").text("");
                            $("#insert").val('submit');

                        }
                        else if (data == "error") {
                            alert("error");
                        }
                    }
                });
                            //Go to succeeded page
            }
            else {
                $("#message").text("Invalid");

            }

            return false;


        }
        
        */
    </script>

    <script type="text/javascript">
        $(document).ready(function () {

            
                $("#sub").click(function () {
                    var title1 = $('[name="mytext1[]"]');
                    console.log(title1[0]);
                    alert(title1[0]);
                    var el = document.getElementById("faculty_chosen");
                    var title = $("#title").val();
                    var price = $("#price").val();
                    var faculty = el.options[el.selectedIndex].value
                    var contact = $("#contact").val();
                    var uploader = window.localStorage.getItem("id");
                    var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;   //Regexp to check if email is valid

                    var dataString = "title=" + title + "&price=" + price + "&faculty=" + faculty + "&contact=" + contact + "&uploader=" + uploader + "&insert=";

                    if ($.trim(title).length > 0 & $.trim(price).length > 0) {
                        $.ajax({
                            type: "POST",
                            url: "http://forwardingenuity.com/insert_book.php",
                            data: dataString,
                            crossDomain: true,
                            cache: false,
                            beforeSend: function () { $("#insert").val('Connecting...'); },
                            success: function (data) {
                                if (data == "success") {
                                    //alert("inserted");                      
                                    $("#Par_empty").text("");
                                    $("#insert").val('submit');
    
                                }
                                else if (data == "error") {
                                    alert("error");
                                }
                            }
                        });
                                    //Go to succeeded page
                    }
                    else {
                        $("#message").text("Invalid");

                    }

                    return false;

                });

            

        });




    </script>
    <script type="text/javascript">
        
        $("#sub").click(function () {

            setTimeout(function () {

                window.location.replace("userPage.html");

            }, 300);
        });


    </script>



</body>
</html>