<!DOCTYPE html>
<html>
<head>
    <title>User Page</title>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="scripts/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <link href="css/anime.css" rel="stylesheet">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    
    <meta http-equiv="Content-Security-Policy" content="default-src *; style-src *  'unsafe-inline'; script-src *  'unsafe-inline'; media-src *">
    
    <script type="text/javascript" src="scripts/cordova-2.4.0.js"></script>

    <script type="text/javascript">


        function getImage() {
            navigator.camera.getPicture(uploadPhoto, function (message) {
                alert('get picture failed');
            }, {
                quality: 100,
                destinationType: navigator.camera.DestinationType.FILE_URI,
                sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            });
        }

        function uploadPhoto(imageURI) {
            var options = new FileUploadOptions();
            options.fileKey = "file";
            options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
            $("#photo_chosen").text(imageURI.substr(imageURI.lastIndexOf('/') + 1));
            options.mimeType = "image/jpeg";
            console.log(options.fileName);
            var params = new Object();
            params.value1 = "test";
            params.value2 = "param";
            options.params = params;
            options.chunkedMode = false;

            var ft = new FileTransfer();
            ft.upload(imageURI, "http://forwardingenuity.com/insert_image1.php", function (result) {
                console.log(JSON.stringify(result));
            }, function (error) {
                console.log(JSON.stringify(error));
            }, options);


/*            $(".image_submit").click(function () {

                if (window.localStorage.getItem("image_pressed") != "1") {
                    var ident = this.id;
                    var num = ident.replace(/^\D+/g, "");
                    var tagi = "#";
                    tagi += "image_number"+num;


                var ft = new FileTransfer();
                ft.upload(imageURI, "http://forwardingenuity.com/insert_image1.php", function (result) {
                    console.log(JSON.stringify(result));
                }, function (error) {
                    console.log(JSON.stringify(error));
                }, options);

                window.location.replace("image_upload_test.html");
            }
            });*/

        }







        //



    </script>

    <style>
        hr{
            border-color:#adffd6;

        }

    </style>
</head>
<body style="background-color:white;">


    
    <script type="text/javascript">
        $(document).ready(function () {
            window.localStorage.setItem("faculty_ind", "0");
            window.localStorage.setItem("contact_ind", "0");
            window.localStorage.setItem("Title_ind", "0");
            window.localStorage.setItem("price_ind", "0");
            window.localStorage.setItem("pressed", "0");
            window.localStorage.setItem("image_pressed", "0");
            if (window.localStorage.getItem("success") == "1" && window.localStorage.getItem("book_inserted")== "1")
            {
                setTimeout(function () {

                    alert("Success");
                },500)
                
            }
           else if (window.localStorage.getItem("book_inserted") == "0") {
                setTimeout(function () {

                    alert("Oops! Network error, try again");
                }, 500)

            }

            window.localStorage.setItem("success", "0");
            window.localStorage.setItem("book_inserted", "2");
            var email_stred = window.localStorage.getItem("emai");
           // alert(window.localStorage.getItem("emai"));
            var userName = email_stred.substr(0, email_stred.indexOf('@'));
            window.localStorage.setItem("UserName", userName);
            $("#user").text(userName);
            if (window.localStorage.getItem("logged_in") != "1") {

                

                    //Regexp to check if email is valid

                    var dataString = window.localStorage.getItem("datstr");     //from previous page
                    window.localStorage.setItem("logged_in", "1");
                    var email_stred = window.localStorage.getItem("emai");
                    var userName = email_stred.substr(0, email_stred.indexOf('@'));
                    window.localStorage.setItem("UserName", userName);
                    $("#user").text(userName);
                    if(window.localStorage.getItem("Alreadr_member")!="1"){
                    $.ajax({
                        type: "POST",                                           //method
                        url: "http://forwardingenuity.com/insert_user.php",     //url   
                        data: dataString,                                       //data sent as concatinated string
                        crossDomain: true,
                        cache: false,
                        timeout:7000,
                        beforeSend: function () { $("#insert").val('Connecting...'); },


                        success: function (data) {
                            if (data == "success") {
                                $("#Par_empty").text("");
                                $("#insert").val('submit');
                                window.localStorage.setItem("erring", "0");

                            }
                            else if (data == "error") {
                                window.location.replace("signUp.html");
                                alert("error");
                            }
                        },
                        error: function (jqXHR,exception) {
                            window.localStorage.setItem("erring", "1");
                            window.localStorage.setItem("logged_in", "0");
                            window.location.replace("signUp.html");
                            //window.location.href="signUp.html";
                            if (data) {
                                window.localStorage.setItem("erring", "1");
                                window.localStorage.setItem("logged_in", "0");
                                window.location.replace("signUp.html");
                              //  window.location.href = "signUp.html";
                            }
                            else {

                                window.localStorage.setItem("erring", "1");
                                window.localStorage.setItem("logged_in", "0");
                                window.location.replace("signUp.html");
                                //window.location.href = "signUp.html";
                            }

                        }

                        
                    });
                    
                    return false;
                    }



                

            }
            

               var url1 = "http://forwardingenuity.com/json_users.php"; //Get url of php file containing json

                var ourRequest = new XMLHttpRequest(); //create XMLHttpRequest object to request for the JSON data
                ourRequest.open("GET", url1);   //Opening...    
                 //container div
                ourRequest.onload = function () {
                  


                    //request has loaded
                    //window.localStorage.setItem("Holding", ourRequest.responseText);
                    var ourData = JSON.parse(ourRequest.responseText);      //change the received response text to an actuall array of objects
                    var books = 0;        //any books under the faculty?
                   // console.log(ourData);
                    
                    //var ourData2 = JSON.parse(window.localStorage.getItem("Holding"));
                    var info_length = (ourData.length);
                    
                    for (var j = 0; j < info_length; j++) {
                        if (ourData[j].email == window.localStorage.getItem("emai")) {
                            window.localStorage.setItem("id", ourData[j].id);
                            //alert(ourData[j].id);
                            break;
                            
                        }
                        
                    }

                    for (var i = 0; i < info_length; i++) {
                        if (ourData[i].email == email && ourData[i].password == password)    //find books under faculty
                        {
                            window.localStorage.setItem("emai", ourData[i].email);
                            window.localStorage.setItem("Alreadr_member", "1");
                            window.localStorage.setItem("id", ourData[i].id);
                            alert(ourData[i].id);
                            window.location.replace("userPage.html");

                        }
                        //books++;
                        else
                        {
                                
                        }

                    }
                    if (books == 0) {
                        //alert("No books available");
                        //No books in the div
                        $("#Par_empty").text("Email/Password combination is not valid");

                    }

                    /*var par = document.createElement('p');
                    par.id = "paragraph" + i;*-
                    par.innerHTML = '<strong>' + ourData2[1].title + '</strong>' + '<br />' + 'R400' + '&nbsp &nbsp &nbsp' + '0739995999';
                    outDiv.appendChild(par);
                  */

                }
                ourRequest.send();
                            //Go to succeeded page
            





        });
      
      function logout() {
          var Logout_button = document.getElementById("logout");
          window.localStorage.clear();
          window.localStorage.setItem("logged_in", "0");
          window.location.replace("index.html");

      }
      
      $("#sub").click(function () {

          //Regexp to check if email is valid

          var dataString = window.localStorage.getItem("datstr");     //from previous page
          window.localStorage.setItem("logged_in", "1");
          
          $.ajax({
              type: "POST",                                           //method
              url: "http://forwardingenuity.com/insert_book.php",     //url   
              data: dataString,                                       //data sent as concatinated string
              crossDomain: true,
              cache: false,
              timeout: 7777,
              beforeSend: function () { $("#insert").val('Connecting...'); },
              success: function (data) {
                  if (data == "success") {
                      $("#Par_empty").text("");
                      $("#insert").val('submit');

                  }
                  else if (data == "error") {
                      alert("error");
                  }
              }
          });

          return false;




      });

        /*
      $("#add_more").click(function () {
          var max_fields = 10; //maximum input boxes allowed
          var wrapper = $(".input_fields_wrap"); //Fields wrapper
          var add_button = $(".add_field_button"); //Add button ID

          var x = 1; //initlal text box count
          $(add_button).click(function (e) { //on add input button click
              e.preventDefault();
              if (x < max_fields) { //max input box allowed
                  x++; //text box increment
                  $(wrapper).append('<div><input type="text" name="mytext[]"/><a href="#" class="remove_field">Remove</a></div>'); //add input box
              }
          });

          $(wrapper).on("click", ".remove_field", function (e) { //user click on remove text
              e.preventDefault(); $(this).parent('div').remove(); x--;
          })
      });

      */
    </script>

    


    
    <div class="bd-example">
        <div id="wrapper" style="text-align: center">
            <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse">
                <!--<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>-->

                <a href="index.html" class="nav nav-navbar navbar navbar-center navbar-brand" style="z-index:100;">Home</a>


                <button class="navbar navbar-brand2 navbar-center btn btn-black1 btn-lg" type="button" id="add" style="display:inline-block" data-toggle="modal" data-target="#myModal">
                    <span class="glyphicon glyphicon-plus white"></span>
                </button>

                <button class="btn1 btn-black navbar-pull-right pull-right" type="button" id="logout" aria-expanded="false" onclick="logout()">
                    <center>Logout</center>
                </button>
                <span class="pull-right col-sm-1" style="color:black;">Logged in as:&nbsp<span id="user"></span></span>


                    


                    <!--   <button class="btn btn-black pull-right" type="button" id="logout" aria-expanded="false" onclick="logout()">
               Logout
           </button>
            -->

                
</nav>
        </div>
        </div>
   <br/>
    <br />
    <div class="container" id="book_case">
        <center> <h3 style="color:#a1a2a3;"><strong>My Books</strong></h3></center>

        <hr/>


    </div>


    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Modal Header</h4>
                    <p class="text-danger" id="message"></p>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group input_fields_wrap">
                            <label>Title</label>
                            <span class="pull-right"><button class="btn3 btn-white add_field_button" type="button" id="#add_more" style="display:inline-block">
                                        <span class="glyphicon glyphicon-plus gray"></span>
                                        </button>
                                <button class="btn3 btn-white remove_field_button" type="button" id="#remove" style="display:inline-block">
                                    <span class="glyphicon glyphicon-minus gray"></span>
                                </button>
                                
                                </span>
                            
                            <input type="text" name="mytext[]" class="form-control" placeholder="Enter title" id="title" />

                        </div>
                        <div class="form-group input_fields_wrap1">
                            <label>Price</label>
                            <input type="number" class="form-control" name="mytext[]" placeholder="Enter Price" id="price" />
                        </div>

                        <div class="form-group input_fields_wrap3">
                            <label>Contact</label>
                            <input type="number" class="form-control" name="mytext[]" placeholder="Enter Phone number" id="contact" />
                        </div>


                        <div class="form-group input_fields_wrap2">
                            <label>Faculty</label>
                            <select class="form-control" id="faculty_chosen" name="mytext[]">
                                <option value="Economic and Management Sciences">Economic and Management Sciences</option>
                                <option value="Education">Education</option>
                                <option value="Engineering, Built Environment and IT">Engineering, Built Environment & IT</option>
                                <option value="Health Sciences">Health Sciences</option>
                                <option value="Humanities">Humanities</option>
                                <option value="Law">Law</option>
                                <option value="Natural and Agricultural Sciences">Natural & Agricultural Sciences</option>
                                <option value="Theology">Theology</option>
                                <option value="Vertinary Science">Vertinary Science</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="sub">Submit</button>
                </div>
            </div>

        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            var max_fields = 5; //maximum input boxes allowed
            var wrapper = $(".input_fields_wrap"); //Fields wrapper
            var wrapper1 = $(".input_fields_wrap1");
            var wrapper2 = $(".input_fields_wrap2");
            var add_button = $(".add_field_button"); //Add button ID
            var rmv_button = $(".remove_field_button");
            var x = 1; //initlal text box count
            window.localStorage.setItem("elems", x);
            $(add_button).click(function (e) { //on add input button click
                e.preventDefault();
                if (x < max_fields) { //max input box allowed
                    
                    x++; //text box increment
                    $(wrapper).append('<div id="titl' + x + '"><input type="text" name="mytext1[]" class="form-control" placeholder="Enter title" id="title'+x+'" /></div>'); //add input box
                    $(wrapper1).append('<div id="pri' + x + '"><input type="number" class="form-control" name="mytext2[]" placeholder="Enter Price" id="price' + x + '" /></div>');
                    $(wrapper2).append('<div id="facul' + x + '"><select class="form-control" id="faculty_chosen' + x + '" name="mytext3[]"><option value="Economic and Management Sciences">Economic and Management Sciences</option><option value="Education">Education</option><option value="Engineering, Built Environment and IT">Engineering, Built Environment & IT</option><option value="Health Sciences">Health Sciences</option><option value="Humanities">Humanities</option><option value="Humanities">Humanities</option><option value="Natural and Agricultural Sciences">Natural & Agricultural Sciences</option><option value="Theology">Theology</option><option value="Vertinary Science">Vertinary Science</option></select></div>');
                    window.localStorage.setItem("elems", x);
                }
            });

            $(rmv_button).click(function(e){ //user click on remove text
                //e.preventDefault(); $(this).parent('div').remove();
                var wrapper = $(".input_fields_wrap");
                var wrapper1 = $(".input_fields_wrap1");
                var wrapper2 = $(".input_fields_wrap2");
                if (x == 2) {
                    $('#titl2').remove();
                    $('#pri2').remove();
                    $('#facul2').remove();

                }
                if (x == 3) {
                    $('#titl3').remove();
                    $('#pri3').remove();
                    $('#facul3').remove();

                }
                if (x == 4) {
                    $('#titl4').remove();
                    $('#pri4').remove();
                    $('#facul4').remove();

                }
                if (x == 5) {
                    $('#titl5').remove();
                    $('#pri5').remove();
                    $('#facul5').remove();

                }
                if(x!=1){
                    x--;
                    window.localStorage.setItem("elems", x);
                }
            });
           
        });
      /*  function submitBooks() {

            var el = document.getElementById("faculty_chosen");
            var title = $("#title").val();
            var price = $("#price").val();
            var faculty = el.options[el.selectedIndex].value
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;   //Regexp to check if email is valid
          
            var dataString = "title=" + title + "&price=" + price + "&faculty=" + faculty + "&insert=";
            
            if ($.trim(title).length > 0 & $.trim(price).length > 0) {
                $.ajax({
                    type: "POST",
                    url: "http://forwardingenuity.com/insert_book.php",
                    data: dataString,
                    crossDomain: true,
                    cache: false,
                    beforeSend: function () { $("#insert").val('Connecting...'); },
                    success: function (data) {
                        if (data == "success") {
                            alert("inserted");                      
                            $("#message").text("");
                            $("#insert").val('submit');

                        }
                        else if (data == "error") {
                            alert("error");
                        }
                    }
                });
                            //Go to succeeded page
            }
            else {
                $("#message").text("Invalid");

            }

            return false;


        }
        
        */
    </script>

    <script type="text/javascript">
        $(document).ready(function () {

            
                $("#sub").click(function () {
                    var title2 = "#title2";
                    var price2 = "#price2";
                    var faculty_chosen2 = "#faculty_chosen2";
                    var title3 = "#title3";
                    var price3 = "#price3";
                    var faculty_chosen3 = "#faculty_chosen3";
                    var title4 = "#title4";
                    var price4 = "#price4";
                    var faculty_chosen4 = "#faculty_chosen4";
                    var title5 = "#title5";
                    var price5 = "#price5";
                    var faculty_chosen5 = "#faculty_chosen5";
                    var datastring1 = '';
                    
                    var titleElem2 = document.getElementById("title2");
                    var priceElem2 = document.getElementById("price2");
                    
                    var titleElem3 = document.getElementById("title3");
                    var priceElem3 = document.getElementById("price3");
                    
                    var titleElem4 = document.getElementById("title4");
                    var priceElem4 = document.getElementById("price4");
                    
                    var titleElem5 = document.getElementById("title5");
                    var priceElem5 = document.getElementById("price5");


                    window.localStorage.setItem("title_check", "1");
                    window.localStorage.setItem("price_check", "1");
                    
                    var elements = window.localStorage.getItem("elems");
                    if (window.localStorage.getItem("elems") >= "2") {

                    switch(elements){
                        case "5":

                        titleC5 = $(title5).val();
                        priceC5 = $(price5).val();
                        titleC5 = $(title5).val();
                        el5 = document.getElementById("faculty_chosen5");
                        faculty5 = el5.options[el5.selectedIndex].value;
                        datastring1 += "&title5=" + titleC5 + "&price5=" + priceC5 + "&faculty5=" + faculty5;
                        if(titleC5=='' && priceC5!='')
                            {
                            $("#message").text("5th Title field left empty");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");
                            titleElem5.className += " btn-dan";
                            return;
                        }
                        else if (titleC5 != '' && priceC5 == '') {
                            $("#message").text("5th Price field left empty or contains non-numeric text(Do not put an R ahead of the price)");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");
                            priceElem5.className += " btn-dan";
                            return;
                        }
                        else if (titleC5 == '' && priceC5 == '') {
                            $("#message").text("5th Price and Title fields left empty");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");
                            titleElem5.className += " btn-dan";
                            priceElem5.className += " btn-dan";
                            return;
                        }

                        case "4":
                        titleC4 = $(title4).val();
                        priceC4 = $(price4).val();
                        titleC4 = $(title4).val();
                        el4 = document.getElementById("faculty_chosen4");
                        faculty4 = el4.options[el4.selectedIndex].value;
                        datastring1 += "&title4=" + titleC4 + "&price4=" + priceC4 + "&faculty4=" + faculty4;

                        if (titleC4 == '' && priceC4 != '') {
                            $("#message").text("4th Title field left empty");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");
                            titleElem4.className += " btn-dan";
                            
                            return;
                        }
                        else if (titleC4 != '' && priceC4 == '') {
                            $("#message").text("4th Price field left empty or contains non-numeric text(Do not put an R ahead of the price)");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");

                            
                            priceElem4.className += " btn-dan";
                            return;
                        }
                        else if (titleC4 == '' && priceC4 == '') {
                            $("#message").text("4th Price and Title fields left empty");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");

                            titleElem4.className += " btn-dan";
                            priceElem4.className += " btn-dan";

                            return;
                        }

                        case "3":
                        titleC3 = $(title3).val();
                        priceC3 = $(price3).val();
                        titleC3 = $(title3).val();
                        el3 = document.getElementById("faculty_chosen3");
                        faculty3 = el3.options[el3.selectedIndex].value;
                        datastring1 += "&title3=" + titleC3 + "&price3=" + priceC3 + "&faculty3=" + faculty3;
                        if (titleC3 == '' && priceC3 != '') {
                            $("#message").text("3rd Title field left empty");

                            titleElem3.className += " btn-dan";
                            
                            return;
                        }
                        else if (titleC3 != '' && priceC3 == '') {
                            $("#message").text("3rd Price field left empty or contains non-numeric text(Do not put an R ahead of the price)");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");
                            
                            priceElem3.className += " btn-dan";

                            return;
                        }
                        else if (titleC3 == '' && priceC3 == '') {
                            $("#message").text("3rd Price and Title fields left empty");
                            window.localStorage.setItem("title_check", "0");
                            window.localStorage.setItem("price_check", "0");

                            titleElem3.className += " btn-dan";
                            priceElem3.className += " btn-dan";
                            return;
                        }

                        case "2":
                            titleC2 = $(title2).val();
                            priceC2 = $(price2).val();
                            titleC2 = $(title2).val();
                            el2 = document.getElementById("faculty_chosen2");
                            faculty2 = el2.options[el2.selectedIndex].value;
                            datastring1 += "&title2=" + titleC2 + "&price2=" + priceC2 + "&faculty2=" + faculty2;
                            if (titleC2 == '' && priceC2 != '') {
                                $("#message").text("2nd Title field left empty");

                                titleElem2.className += " btn-dan";
                                

                                return;
                            }
                            else if (titleC2 != '' && priceC2 == '') {
                                $("#message").text("2nd Price field left empty or contains non-numeric text(Do not put an R ahead of the price)");
                                window.localStorage.setItem("title_check", "0");
                                window.localStorage.setItem("price_check", "0");

                                
                                priceElem2.className += " btn-dan";

                                return;
                            }
                            else if (titleC2 == '' && priceC2 == '') {
                                $("#message").text("2nd Price and Title fields left empty");
                                window.localStorage.setItem("title_check", "0");
                                window.localStorage.setItem("price_check", "0");

                                titleElem2.className += " btn-dan";
                                priceElem2.className += " btn-dan";
                                return;
                            }

                            
                        default:
                            if (title == '' && price != '') {
                                $("#message").text("1st Title field left empty");
                                window.localStorage.setItem("title_check", "0");
                                window.localStorage.setItem("price_check", "0");
                                return;
                            }
                            else if (title != '' && price == '') {
                                $("#message").text("1st Price field left empty or contains non-numeric text(Do not put an R ahead of the price)");
                                window.localStorage.setItem("title_check", "0");
                                window.localStorage.setItem("price_check", "0");
                                return;
                            }
                            else if (title == '' && price == '') {
                                $("#message").text("1st Price and Title fields left empty");
                                window.localStorage.setItem("title_check", "0");
                                window.localStorage.setItem("price_check", "0");
                                return;
                            }
                            break;

                    }
                        

                    }
                    
                    
                    var el = document.getElementById("faculty_chosen");
                    var title = $("#title").val();
                    var price = $("#price").val();
                    var titleElem = document.getElementById("title");
                    var priceElem = document.getElementById("price");

                    var faculty = el.options[el.selectedIndex].value;
                    var contact = $("#contact").val();
                    var contactElem = document.getElementById("contact");
                    if ($.trim(contact).length == 0) {
                        $("#message").text("Contact field left empty");
                        window.localStorage.setItem("title_check", "0");
                        contactElem.className += " btn-dan";
                        
                    }

                    if (title == '' && price != '') {
                        $("#message").text("1st Title field left empty");
                        window.localStorage.setItem("title_check", "0");
                        window.localStorage.setItem("price_check", "0");
                        titleElem.className += " btn-dan";
                        return;
                    }
                    else if (title != '' && price == '') {
                        $("#message").text("1st Price field left empty or contains non-numeric text(Do not put an R ahead of the price)");
                        window.localStorage.setItem("title_check", "0");
                        window.localStorage.setItem("price_check", "0");
                        priceElem.className += " btn-dan";
                        return;
                    }
                    else if (title == '' && price == '') {
                        $("#message").text("1st Price and Title fields left empty");
                        window.localStorage.setItem("title_check", "0");
                        window.localStorage.setItem("price_check", "0");
                        titleElem.className += " btn-dan";
                        priceElem.className += " btn-dan";
                        return;
                    }


                    
                    //alert(window.localStorage.getItem("id"));
                    var uploader = window.localStorage.getItem("id");
                    var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;   //Regexp to check if email is valid
                    if (elements< "2")
                     {
                    var dataString = "title=" + title + "&price=" + price + "&faculty=" + faculty + "&contact=" + contact + "&uploader=" + uploader + "&insert=";
                    }

                    else {
                        var dataString = "title=" + title + "&price=" + price + "&elements=" + elements + "&faculty=" + faculty + "&contact=" + contact + datastring1 + "&uploader=" + uploader + "&insert=";

                    }
                    if ($.trim(contact).length > 0) {
                        $.ajax({
                            type: "POST",
                            url: "http://forwardingenuity.com/insert_book1.php",
                            data: dataString,
                            processData:false,
                            timeout:7000,
                            success: function (data) {
                                if (data == "success") {
                                    //alert("inserted");                      
                                    $("#Par_empty").text("");
                                    $("#insert").val('submit');
                                    window.localStorage.setItem("book_inserted", "1");
    
                                }
                                else if (data == "error") {
                                    alert("error");
                                    window.localStorage.setItem("book_inserted", "0");
                                }
                            }
                        });
                                    //Go to succeeded page
                    }
                    else {
                        $("#message").text("Contact field left empty or contains non-numeric text(use numbers only)");
                        window.localStorage.setItem("title_check", "0");
                        return;
                    }

                    return false;

                });

            

        });




    </script>
    <script type="text/javascript">
        
        $("#sub").click(function () {

            setTimeout(function () {
                if (window.localStorage.getItem("title_check") == "1" && window.localStorage.getItem("price_check") == "1")
                {
                    window.localStorage.setItem("success", "1");
                window.location.replace("userPage.html");
                }
                else {
                    alert("Fields left empty");
                }
            }, 2000);
        });


    </script>

    <script type="text/javascript">

        $(document).ready(function () {
            var url1 = "http://forwardingenuity.com/json.php"; //Get url of php file containing json


            var ourRequest = new XMLHttpRequest(); //create XMLHttpRequest object to request for the JSON data
            ourRequest.open("GET", url1);   //Opening...    
            var outDiv = document.getElementById("book_case"); //container div

            ourRequest.onload = function () {
                console.log("Here");

              //  $('#loading-indicator').attr('src', 'new.png');
                //$('#loading-indicator').css('top', '0px');
                //request has loaded
                //window.localStorage.setItem("Holding", ourRequest.responseText);
                var ourData = JSON.parse(ourRequest.responseText);      //change the received response text to an actuall array of objects
                var books = 0;        //any books under the faculty?

                var stored_title = [];
                var stored_price = [];
                var stored_contact = [];
                var stored_faculty = [];

                //var ourData2 = JSON.parse(window.localStorage.getItem("Holding"));
                var info_length = (ourData.length);
                for (var i = 0; i < info_length; i++) {
                    if (ourData[i].uploader != window.localStorage.getItem("id"))    //find books under faculty
                    {
                        continue;
                    }
                    stored_title[books] = ourData[i].title;
                    stored_price[books] = ourData[i].price;
                    stored_contact[books] = ourData[i].contact;
                    stored_faculty[books] = ourData[i].faculty;
                    window.localStorage.setItem("book_title", JSON.stringify(stored_title));
                    window.localStorage.setItem("book_price", JSON.stringify(stored_price));
                    window.localStorage.setItem("book_contact", JSON.stringify(stored_contact));
                    window.localStorage.setItem("book_faculty", JSON.stringify(stored_faculty));
                    window.localStorage.setItem("index" + books, books);
                    var modal = document.createElement('div');
                    modal.id = "mod" + books;
                    modal.className = "modal fade";
                    modal.setAttribute('role', 'dialog');
                   /* modal.innerHTML = '<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Edit Book info</h4><p class="text-danger" id="message"></p></div>';
                    modal.innerHTML += '<div class="modal-body"><form><div class="form-group"><label>' + ourData[i].title + '<span class="pull-right"><button class="btn3 btn-white" type="button" style="display:inline-block"><span class="glyphicon glyphicon-plus gray"></span></button>';
                    modal.innerHTML += '</span></label></div><div class="form-group"> <label>' + ourData[i].price + '</label></div><div class="form-group"> <label>' + ourData[i].contact + '</label></div><div class="form-group"> <label>' + ourData[i].faculty + '</label></div></form></div></div>';
                   */
                    modal.innerHTML = '<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Edit book info -</h4><span>&nbsp Enter only the fields you want to edit</span><br/><p class="text-danger" id="edit_message"></p></div><div class="modal-body"><form><div class="form-group input_fields"><label>' + ourData[i].title + '</label><input type="text" name="mytext[]" class="form-control" placeholder="Enter title" id="edit_title' + books + '" /></div><div class="form-group input_fields1"><label>R' + ourData[i].price + '</label><input type="number" name="mytext[]" class="form-control" placeholder="Enter price" id="edit_price' + books + '" /></div><div class="form-group input_fields2"><label>' + ourData[i].contact + '</label><input type="number" name="mytext[]" class="form-control" placeholder="Enter Phone Number" id="edit_contact' + books + '" /><div class="form-group input_fields3"><label>' + ourData[i].faculty + '</label><select class="form-control" id="edit_faculty' + books + '" name="mytext3[]"><option value="Economic and Management Sciences">Economic and Management Sciences</option><option value="Education">Education</option><option value="Engineering, Built Environment and IT">Engineering, Built Environment & IT</option><option value="Health Sciences">Health Sciences</option><option value="Humanities">Humanities</option><option value="Natural and Agricultural Sciences">Natural & Agricultural Sciences</option><option value="Theology">Theology</option><option value="Vertinary Science">Vertinary Science</option></select></div></form><div class="modal-footer"><button type="button" class="btn btn-default editing" onclick="trying();refreshing()" id="edit_submit' + books + '" value="' + ourData[i].id + '">Submit - Double Tap!</button></div>';

                    var modal_image = document.createElement('div');
                    modal_image.id = "image_mod" + books;
                    modal_image.className = "modal fade";
                    modal_image.setAttribute('role', 'dialog');
                    /* modal.innerHTML = '<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Edit Book info</h4><p class="text-danger" id="message"></p></div>';
                     modal.innerHTML += '<div class="modal-body"><form><div class="form-group"><label>' + ourData[i].title + '<span class="pull-right"><button class="btn3 btn-white" type="button" style="display:inline-block"><span class="glyphicon glyphicon-plus gray"></span></button>';
                     modal.innerHTML += '</span></label></div><div class="form-group"> <label>' + ourData[i].price + '</label></div><div class="form-group"> <label>' + ourData[i].contact + '</label></div><div class="form-group"> <label>' + ourData[i].faculty + '</label></div></form></div></div>';
                    */
                    modal_image.innerHTML = '<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Upload an image</h4></div><div class="modal-body"><button onclick="getImage();">Choose a Photo</button><div id="photo_chosen" style="width:100%; object-fit:contain; border: 1px solid black; padding:10px; margin-top:10px; margin-left:3px; display:inline-block; border-color:black; top:2px;"></div><div class="modal-footer"><button type="button" class="btn btn-default image_submit" id="uplo' + books + '">Submit</button></div>';


                    var inDiv = document.createElement('div');
                    var edit_button = document.createElement('button');
                    
                    edit_button.innerHTML = '<strong>Edit</strong>';
                    edit_button.className += "btn1 btn-info animated fadeInLeft";
                    edit_button.setAttribute('data-toggle', 'modal');
                    edit_button.setAttribute('data-target', '#mod'+books);
                    /*edit_button.onclick = function () {
                        var ind = JSON.parse(window.localStorage.getItem("book_title")).length;
                        var titles = JSON.parse(window.localStorage.getItem("book_title"));
                        for (var i = 0; i < ind; i++) {
                            toggle(titles[i]);
                        }
                        
                    }*/

                    var sold_button = document.createElement('button');
                    sold_button.innerHTML = '<strong>SOLD!!</strong>';
                    sold_button.className += "btn1 btn-success animated fadeInLeft";
                    var wrapperDiv = document.createElement('div');
                    wrapperDiv.className = "animated fadeInLeft";
                    var remove_button = document.createElement('button');
                    remove_button.innerHTML = '<strong>Remove</strong>';
                    remove_button.className += "btn1 btn-danger animated fadeInLeft";
                    
                    
                    inDiv.className += "animated fadeInLeft";
                    inDiv.innerHTML = '<div id="photo_chosen' + books + '" style="float:left; margin-right: 10px; height:95px; border: 1px solid black; width:100px; margin-top:0px; margin-left:3px; display:inline-block; border-color:black; top:2px;"><a role="button" data-toggle="modal" data-target="#image_mod'+books+'"><img id=image_number' + books + ' src="3dBook3.png" style="width:100%; height:100%; object-fit:contain;" /></a></div><p style="font-size:20px;">' + ourData[i].title + ' - R' + ourData[i].price + '</p><br/>';
                    inDiv.appendChild(edit_button);
                    inDiv.appendChild(sold_button);
                    inDiv.appendChild(remove_button);
                    var hzr = document.createElement('hr');
                   /* var par = document.createElement('p');          //create paragraph to hold content coming in
                    var hzr = document.createElement('hr');         //Horizontal rule
                    par.id = "paragraph" + i;                       //id
                    par.style.fontSize = "large";                   //font-size
                    par.className += "animated fadeInLeft";         //fade in from animate.css
                    par.innerHTML = '<strong>' + ourData[i].title + '</strong>' + '<br />' + 'R' + ourData[i].price + '<span class="pull-right">' + ourData[i].contact + '</span>'; //putting info in paragraph
                    */
                    wrapperDiv.appendChild(inDiv);            //add paragraph to container
                    outDiv.appendChild(wrapperDiv);
                    outDiv.appendChild(hzr);            //add horizontal rulr to div
                    outDiv.appendChild(modal);
                    outDiv.appendChild(modal_image);
                    books++;
                }
                if (books == 0) {
                    //alert("No books available");
                    //No books in the div
                   // setTimeout(function () { alert(""); }, 1200);     //delay before alert

                }

                /*var par = document.createElement('p');
                par.id = "paragraph" + i;*-
                par.innerHTML = '<strong>' + ourData2[1].title + '</strong>' + '<br />' + 'R400' + '&nbsp &nbsp &nbsp' + '0739995999';
                outDiv.appendChild(par);
              */

            }
            ourRequest.send();      //send request



        });

        var toggle = function () {

            alert(window.localStorage.getItem("book_title"));


        }

        function buttonTitle(){

            
            var max_fields = 1; //maximum input boxes allowed
            var wrapper = $(".input_fields"); //Fields wrapper
            var add_button = $("#butti");
            var x = 0; //initlal text box count
            
             //on add input button click
             //   e.preventDefault();
                if (window.localStorage.getItem("Title_ind")!="1") { //max input box allowed
                    window.localStorage.setItem("Title_ind", "1");
                    x++; //text box increment
                    
                    $(wrapper).append('<div id="titl' + x + '"><input type="text" name="mytext1[]" class="form-control" placeholder="Enter title" id="Edit_title"/></div>'); //add input box
                    
                }
            

        }

        function buttonPrice() {


            var max_fields = 1; //maximum input boxes allowed
            var wrapper = $(".input_fields1"); //Fields wrapper
            var add_button = $("#butti2");
            var x = 0; //initlal text box count
            
            
                if (window.localStorage.getItem("price_ind") != "1") { //max input box allowed
                    window.localStorage.setItem("price_ind","1");
                    x++; //text box increment
                    $(wrapper).append('<div id="titl' + x + '"><input type="number" name="mytext1[]" class="form-control" placeholder="Enter Price" id="Edit_price"/></div>'); //add input box

                }
            

        }

        function buttonContact() {


            var max_fields = 1; //maximum input boxes allowed
            var wrapper = $(".input_fields2"); //Fields wrapper
            var add_button = $("#butti3");
            var x = 0; //initlal text box count
            
             //on add input button click
         //       e.preventDefault();
                if (window.localStorage.getItem("contact_ind") != "1") { //max input box allowed
                    window.localStorage.setItem("contact_ind","1");
                    x++; //text box increment

                    $(wrapper).append('<div id="titl' + x + '"><input type="number" name="mytext1[]" class="form-control" placeholder="Enter Phone Number" id="Edit_contact"/></div>'); //add input box

                }
            

        }

        function buttonFaculty() {


            var max_fields = 1; //maximum input boxes allowed
            var wrapper = $(".input_fields3"); //Fields wrapper
            var add_button = $("#butti4");
            var x = 0; //initlal text box count
            
             //on add input button click
           //     e.preventDefault();
                if (window.localStorage.getItem("faculty_ind") != "1") { //max input box allowed
                    window.localStorage.setItem("faculty_ind","1");                    x++; //text box increment
                    $(wrapper).append('<div id="facul' + x + '"><select class="form-control" id="faculty_chosen' + x + '" name="mytext3[]"><option value="Economic and Management Sciences">Economic and Management Sciences</option><option value="Education">Education</option><option value="Engineering, Built Environment and IT">Engineering, Built Environment & IT</option><option value="Health Sciences">Health Sciences</option><option value="Humanities">Humanities</option><option value="Natural and Agricultural Sciences">Natural & Agricultural Sciences</option><option value="Theology">Theology</option><option value="Vertinary Science">Vertinary Science</option></select></div>'); //add input box

                }
            

        }
        function trying() {
            
            $(document).ready(function () {


                $(".editing").click(function () {


                    if (window.localStorage.getItem("pressed") != "1") {
                        var ident = this.id;
                        var num = ident.replace(/^\D+/g, "");
                        var tagi = "#";
                        tagi += ident;
                        var price1 = "#edit_price" + num;
                        var title1 = "#edit_title" + num;
                        var faculty1 = "edit_faculty" + num;
                        var e = document.getElementById(faculty1);
                        var faculty = e.options[e.selectedIndex].value;
                        var contact1 = "#edit_contact" + num;
                        var book_id = $(tagi).val();
                        var price = $(price1).val();
                        var title = $(title1).val();
                        var contact = $(contact1).val();

                        if (title == null) {
                            title = '';

                        }

                        if (price == null) {
                            price = '';

                        }

                        if (contact == null) {
                            contact = '';

                        }


                        var dataString = "&title=" + title + "&contact=" + contact + "&price=" + price + "&faculty=" + faculty + "&id=" + book_id + "&update=";

                        if (1 == 1) {

                            $.ajax({
                                type: "POST",
                                url: "http://forwardingenuity.com/update_book.php",
                                data: dataString,
                                crossDomain: true,
                                cache: false,
                                timeout:7000,
                                beforeSend: function () { $("#insert").val('Connecting...'); },
                                success: function (data) {
                                    if (data == "success") {
                             //           alert("inserted");
                                        $("#Par_empty").text("");
                                        $("#insert").val('submit');

                                    }
                                    else if (data == "error") {
                                        alert("error");
                                    }
                                },
                                error: function (jqXHR, exception) {
                                    alert("Change not made, check internet connection");
                                    //window.location.href="signUp.html";
                                    

                                }
                            });
                           // alert("here");
                            return false;

                            //Go to succeeded page
                        }



                    }


                  




                    //





                });
            });
            

        }



        function refreshing() {
            $(document).ready(function () {

                $(".editing").click(function () {
                    setTimeout(function () {
                        window.location.replace("userPage.html");

                    }, 10);
                    

                })

            })


        }
        

    </script>
    





   

</body>
</html>